// storyd.c

#include <ansi.h>
//#include <zjmud.h>
inherit F_DBASE;
inherit F_SAVE;

// 初始化BOSS系统
#define REFRESH_INTERVAL	10 * 3600

string *story_name;
mapping history;
int     last_update = 0;

nosave mapping interval;
nosave object  running_story;
nosave int flag;
nosave int caimt;
nosave int lingjiang;
nosave int huashanlj;
nosave int a_flag;
nosave int b_flag;
nosave int wjgk_flag;
nosave int khy_flag;
nosave int yitian_flag;
nosave int tulong_flag;
nosave int step;
nosave int wjg_flag;
nosave int shangr_flag;
nosave int niansho_flag;
nosave int wjgl_flag;
int    filter_listener(object ob);
nosave mapping tiku =([
	"山有木兮木有枝":"心悦君兮君不知",
	"人生若只如初见":"何事秋风悲画扇",
	"十年生死两茫茫":"不思量，自难忘",
	"玲珑骰子安红豆":"入骨相思知不知",
	"只愿君心似我心":"定不负相思意",
	"愿得一人心":"白首不分离",
	"《天龙八部》中康敏是否有孩子？":"有",
	"人面不知何处去":"桃花依旧笑春风",
	"春宵一刻值千金":"花有清香月有阴",
	"今人不见古时月":"今月曾经照古人",
	"月上柳梢头":"人约黄昏后",
	"沧海月明珠有泪":"蓝田玉暖玉生烟",
	"男儿何不带吴钩":"收取关山五十州",
	"苟利国家生死以":"岂因祸福避趋之",
	"人生自古谁无死":"留取丹心照汗青",
	"商女不知亡国恨":"隔江犹唱后庭花",
	"我见青山多妩媚":"料青山见我应如是",
	"日照香炉生紫烟":"遥看瀑布挂前川",
	"人间万事":"毫发常重泰山轻",
	"造化钟神秀":"阴阳割昏晓",
	"未到千般恨不消":"庐山烟雨浙江潮",
	"人生得意须尽欢":"莫使金樽空对月",
	"疏影横斜水清浅":"暗香浮动月黄昏",
	"不经一番寒彻骨":"怎得梅花扑鼻香",
	"演员打斗真叫绝（打一字）":"角",
	"两个傻瓜要起身（打一成语）":"蠢蠢欲动",
	"伯牙望知音，琴声意绵绵。打一成语":"一见钟情",
	"武动仙途发生在哪个朝代":"明朝",
	"云一，玉一梭":"澹澹衫儿薄薄罗",
	"尊前拟把归期说":"未语春容先惨咽",
	"饮酒莫辞醉":"醉多适不愁",
	"风卷寒云暮雪晴":"江烟洗尽柳条轻",
	"但使龙城飞将在":"不教胡马度阴山",
	"舞榭歌台":"风流总被雨打风吹去",
	"天南地北双飞客":"老翅几回寒暑",
	"欢乐趣，离别苦":"就中更有痴儿女",
	"床前明月光":"疑是地上霜",
	"明月松间照":"清泉石上流",
	"何当共剪西窗烛":"却话巴山夜雨时",
	"孤舟蓑笠翁":"独钓寒江雪",
	"寻寻觅觅，冷冷清清":"凄凄惨惨戚戚",
	"满地黄花堆积。憔悴损":"如今有谁堪摘",
	"有情风万里卷潮来":"无情送潮归",
	"庭院深深深几许，杨柳堆烟":"帘幕无重数",
	"一曲新词酒一杯":"去年天气旧亭台",
	"春江潮水连海平":"海上明月共潮生",
	"滚滚长江东逝水":"浪花淘尽英雄",
	"枯藤老树昏鸦，小桥流水人家":"古道西风瘦马",
	"一生一代一双人":"争教两处销魂",
	"前不见古人，后不见来者":"念天地之悠悠，独怆然而涕下",
	"《连城诀》中的大宝藏是哪个皇帝聚敛的财宝？":"梁元帝",
	"《天龙八部》中，包不同一生最快乐逍遥的地方是哪里":"瓷器店",
	"《倚天屠龙记》中，殷素素借给张翠山的伞上写了一句什么话？":"斜风细雨不须归",
	"活，你背着我！死，你背着我！这里面的我是谁":"黄蓉",
	"不是她！不是她！不是她！她是谁":"李秋水",
	"孤独求败有过几把剑":"四把",
	"风清扬教了令狐冲什么剑法":"孤独九剑",
	"傻姑姓啥":"曲",
	"郭襄吃过什么动物的奶":"豹",
	"冷月窥人是哪一门门派的":"古墓派",
	"韦小宝有几个老婆":"七个",
	"降龙十八掌第二招是啥":"飞龙在天",
	"《倚天屠龙记》中丐帮传功长老姓啥":"曹",
	"《武动仙途》中有几个人被阉割了":"四个",
	"侠客岛邀请喝腊八粥有多少人来":"二十七个",
	"华山论剑第一次发生在啥时候":"南宋初年",
	"林平之的外公是谁":"王元霸",
	"段正淳有多少女人":"六个",
	"第一个向杨过传授武功的是谁":"穆念慈",
	"第一届华山论剑五大高手外号":"东邪西毒南帝北丐中神通",
	"峨嵋派创始人":"郭襄",
	"小龙女和杨过分开几年后相遇":"16年",
	"国破山河在":"城春草木深",
	"王师北定中原日":"家祭无忘告乃翁",
	"泉眼无声惜细流":"树阴照水爱晴柔",
	"人间四月芳菲尽":"山寺桃花始盛开",
	"泛此忘忧物":"远我遗世情",
	"我偏要勉强，这里面我指谁":"赵敏",
	"石破天的玄铁令哪来的":"烧饼",
	"情花毒用什么可以药可解":"断肠草",
	"谁解开了珍珑棋局":"虚竹",
	"韦小宝何许人氏":"扬州",
	"《四十二章经》有几本":"八本",
	"谁喝过玄冰碧火酒":"石破天",
	"生当作人杰":"死亦为鬼雄",
	"气蒸云梦泽":"波撼岳阳城",
	"草木本有心":"何求美人折",
	"莫怪春来便归去":"江南虽好是他乡",
	"洛阳亲友如相同":"一片冰心在玉壶",
	"苦恨年年压金线":"为他人作嫁衣裳",
	"采得百花成蜜后":"为谁辛苦为谁甜",
	"我自横刀向天笑":"去留肝胆两昆仑",	
	
	"清明时节雨纷纷":"路上行人欲断魂",	
	"慈母手中线":"游子身上衣",
	"海上生明月":"天涯共此时",
	"情人怨遥夜":"竟夕起相思",
	"离离原上草":"一岁一枯荣",
	"野火烧不尽":"春风吹又生",
	"竹外桃花三两枝":"春江水暖鸭先知",
	"相见时难别亦难":"东风无力百花残",
	"锦瑟无端五十弦":"一弦一柱思华年",
	"孤山寺北贾亭西":"水面初平云脚低",
	"昔人已乘黄鹤去":"此地空余黄鹤楼",
	"千里黄云白日曛":"北风吹雁雪纷纷",
	"风急天高猿啸哀":"渚清沙白鸟飞回",
	"莫笑农家腊酒浑":"丰年留客足鸡豚",
	"黑云压城城欲摧":"甲光向日金鳞开",
	"大鹏一日同风起":"扶摇直上九万里",
	"辛苦遭逢起一经":"干戈寥落四周星",
	"剑外忽传收蓟北":"初闻涕泪满衣裳",
	"巴山楚水凄凉地":"二十三年弃置身",
	"丞相祠堂何处寻":"锦官城外柏森森",
	"钟山风雨起苍黄":"百万雄师过大江",
	"天时人事日相催":"冬至阳生春又来",
	"昨夜星辰昨夜风":"画楼西畔桂堂东",
	"为人性僻耽佳句":"语不惊人死不休",
	"人生到处知何似":"应似飞鸿踏雪泥",
	"牛尾乌云泼浓墨":"牛头风雨翩车轴",
	"书卷多情似故人":"晨昏忧乐每相亲",
	"群山万壑赴荆门":"生长明妃尚有村",
	"娉娉袅袅十三余":"豆蔻梢头二月初",
	"独在异乡为异客":"每逢佳节倍思亲",
	"春眠不觉晓":"处处闻啼鸟",
	"碧玉妆成一树高":"万条垂下绿丝绦",
	"千山鸟飞绝":"万径人踪灭",
	"两个黄鹂鸣翠柳":"一行白鹭上青天",
	"白日依山尽":"黄河入海流",
	"人间四月芳菲尽":"山寺桃花始盛开",
	"月落乌啼霜满天":"江枫渔火对愁眠",
	"黄河远上白云间":"一片孤城万仞山",
	"千里莺啼绿映红":"水村山郭酒旗风",
	"秦时明月汉时关":"万里长征人未还",
	"朝辞白帝彩云间":"千里江陵一日还",
	"渭城朝雨徘岢":"客舍青青柳色新",
	"日照香炉生紫烟":"遥看瀑布挂前川",
	"天下攘攘":"皆为利往",
	"咬定青山不放松":"立根原在破岩中",
	"迟日江山丽":"春风花草香",
	"去年今日此门中":"人面桃花相映红",
	"人闲桂花落":"夜静春山空",
	"葡萄美酒夜光杯":"欲饮琵琶马上催",
	"少小离家老大回":"乡音无改鬓毛衰",
	"毕竟西湖六月中":"风光不与四时同",
	"君问归期未有期":"巴山夜雨涨秋池",
	"天门中断楚江开":"碧水东流至此回",
	"李白乘舟将欲行":"忽闻岸上踏歌声",
	"春有百花秋有月":"夏有凉风冬有雪",
	"寒雨连江夜入吴":"平明送客楚山孤",
	"空山不见人":"但闻人语响",
	"文案日成堆":"愁眉拽不开",
	"草长莺飞二月天":"拂堤杨柳醉春烟",
	"黄梅时节家家雨":"青草池塘处处蛙",
	"云想衣裳花想容":"春风拂槛露华浓",
	"自古逢秋悲寂寥":"我言秋日胜春朝",
]);

void init_story();
void go_on_process(object ob);
varargs void start_story(string sname);

string query_save_file()
{
	return DATA_DIR "bossd";
}

void create()
{
	seteuid(ROOT_UID);
	set("channel_id", "答题系统");
	CHANNEL_D->do_channel( this_object(), "sys", "答题已经启动。");

	// 恢复BOSS发生状况
	restore();

	if (! mapp(history))
		history = ([ ]);

	interval = ([ ]);
	set_heart_beat(20);
}

mapping query_tiku()
{
	return tiku;
}

int query_next_update()
{
	return last_update + REFRESH_INTERVAL - time();
}



void heart_beat()
{
	object *players,obk,obj,oby;
	mixed* r;
	string di,dir;
	mixed *files;
	string filk;
	int a1,a2,i,j,shijian,k;
	int w=random(100);
	object dao,jian,ob;
	object jing,road3,wjg,khy;
	int time = time();
	r = localtime(time);
	
	
	if(r[1]==12||r[1]==22||r[1]==32||r[1]==42||r[1]==52||r[1]==02)
	{	
      players = users();
	  b_flag=0;
		for(i = 0; i<sizeof(players); i++)
        {
         players[i]->set("huida",0);
        }
	}
	
	
	if(r[1]==10&&b_flag==0||r[1]==20&&b_flag==0||r[1]==30&&b_flag==0||r[1]==40&&b_flag==0||r[1]==50&&b_flag==0||r[1]==00&&b_flag==0)
	{
		string *timu,timu1;
		timu=keys(tiku);
		timu1=timu[random(sizeof(timu))];
		ob=new("/d/city/npc/zhu");
		players = users();
		b_flag=1;
		shijian = time();
	    for(i = 0; i<sizeof(players); i++)
        {
        players[i]->set("huida",1);
        }
	    shout(HIR"请听题："HIC "『"+timu1+"』"HIC"〖"+ZJURL("cmds:huida "+timu1+" "+shijian+"")ZJSIZE(25)+YEL"回答"HIC"〗"NOR"\n");
	    CHANNEL_D->do_channel(ob, "chat",HIY"『"+timu1+"』"HIC"〖"+ZJURL("cmds:huida "+timu1+" "+shijian+"")ZJSIZE(25)+YEL"回答"HIC"〗"NOR"");	
		if(ob)
		destruct(ob);
	}
	
}